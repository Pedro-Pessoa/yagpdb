{{define "cp_logger"}}

{{template "cp_head" .}}

<header class="page-header">
    <h2>Logger</h2>
</header>

<form role="form" method="post" data-async-form>
    <section class="card mb-2">
        <div class="card card-featured {{if .Logger.LoggerEnabled}}card-featured-success{{else}}card-featured-danger{{end}}">
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-4">
                        <h2 class="card">Discord Logger System</h2>
                        <p>
                            This is a complete log system for discord.<br>
                            The logger is separated in 4 categories:<br>
                            <b>Message Events, Server Events, Member Events and Voice Events</b>.<br><br>
                            If the default setting is being used, all logs will go to the same channel.<br>
                            This can get quite spammy, specially on large servers.<br>
                            To have better logs, you can have each category send their events on a different channel.
                        </p>

                        {{checkbox "logger_enabled" "logger_enabled" "<b>Enable logger?</b>" .Logger.LoggerEnabled}}
                    </div>
                    <div class="col-lg-4 mt-2">
                        <label><b>Default Channel</b></label>
                        <select class="form-control" name="default_logger_channel" data-requireperms-send>
                            {{textChannelOptions .ActiveGuild.Channels .Logger.DefaultLoggerChannel true "None"}}
                        </select>

                        <div class="form-group row">
                            <div class="col-lg-4">
                                <label><b>Required Channels</b></label>
                                <select class="form-control" name="required_logger_channels" id="required_logger_channels" multiple="multiple" data-plugin-multiselect>
                                    {{textChannelOptionsMulti .ActiveGuild.Channels .Logger.RequiredLoggerChannels}}
                                </select>
                            </div>

                            <div class="col-lg-4">
                                <label><b>Required Roles</b></label>
                                <select class="form-control" name="required_logger_roles" id="required_logger_roles" multiple="multiple" data-plugin-multiselect>
                                    {{roleOptionsMulti .ActiveGuild.Roles nil .Logger.RequiredLoggerRoles}}
                                </select>
                            </div>

                            <div class="col-lg-4">
                                <label><b>Required Categories</b></label>
                                <select class="form-control" name="required_logger_categories" id="required_logger_categories" multiple="multiple" data-plugin-multiselect>
                                    {{catChannelOptionsMulti .ActiveGuild.Channels .Logger.RequiredLoggerCategories}}
                                </select>
                            </div>

                            <div class="col-lg-4 mt-2">
                                <label><b>Ignored Channels</b></label>
                                <select class="form-control" name="ignored_logger_channels" id="ignored_logger_channels" multiple="multiple" data-plugin-multiselect>
                                    {{textChannelOptionsMulti .ActiveGuild.Channels .Logger.IgnoredLoggerChannels}}
                                </select>
                            </div>

                            <div class="col-lg-4 mt-2">
                                <label><b>Ignored Roles</b></label>
                                <select class="form-control" name="ignored_logger_roles" id="ignored_logger_roles" multiple="multiple" data-plugin-multiselect>
                                    {{roleOptionsMulti .ActiveGuild.Roles nil .Logger.IgnoredLoggerRoles}}
                                </select>
                            </div>

                            <div class="col-lg-4 mt-2">
                                <label><b>Ignored Categories</b></label>
                                <select class="form-control" name="ignored_logger_categories" id="ignored_logger_categories" multiple="multiple" data-plugin-multiselect>
                                    {{catChannelOptionsMulti .ActiveGuild.Channels .Logger.IgnoredLoggerCategories}}
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    {{template "cp_alerts" .}}

    <div class="row">
        <div class="col-lg-12">
            <div class="row">
                <div class="col-lg-3">
                    <div class="card card-featured card-featured-danger">
                        <header class="card-header">
                            {{checkboxInverted "server_events_enabled" "server_events_enabled" `<h3 class="card">Server Events</h3>` .Logger.ServerEventsEnabled}}
                        </header>
                        <div class="card-body">
                            <div class="form-group">
                                <label><b>Server Events Log Channel</b></label>
                                <select class="form-control" name="server_logger_channel" data-requireperms-send>
                                    {{textChannelOptions .ActiveGuild.Channels .Logger.ServerLoggerChannel true "None"}}
                                </select>
                            </div>

                            {{checkbox "channel_creation_enabled" "channel_creation_enabled" "Log channel creations" .Logger.ChannelCreationEnabled}}
                            {{checkbox "channel_updated_enabled" "channel_updated_enabled" "Log channel updates" .Logger.ChannelUpdatedEnabled}}
                            {{checkbox "channel_deletion_enbaled" "channel_deletion_enbaled" "Log channel deletions" .Logger.ChannelDeletionEnbaled}}
                            {{checkbox "role_creation_enbaled" "role_creation_enbaled" "Log role creations" .Logger.RoleCreationEnbaled}}
                            {{checkbox "role_update_enbaled" "role_update_enbaled" "Log role updateds" .Logger.RoleUpdateEnbaled}}
                            {{checkbox "role_deletion_enbaled" "role_deletion_enbaled" "Log role deletions" .Logger.RoleDeletionEnbaled}}
                            {{checkbox "server_update_enbaled" "server_update_enbaled" "Log server updates" .Logger.ServerUpdateEnbaled}}
                            {{checkbox "emoji_update_enbaled" "emoji_update_enbaled" "Log emoji updates" .Logger.EmojiUpdateEnbaled}}

                            <div class="form-group">
                                <label>Log Message (Leave empty for default) [<span class="announce-length-counter">x</span>/2000]</label><br>
                                <textarea rows="5" class="form-control" name="server_logger_msg" placeholder="Announce message here"  oninput="onCCChanged(this)">{{.Logger.ServerLoggerMSG}}</textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3">
                    <div class="card card-featured card-featured-danger">
                        <header class="card-header">
                            {{checkboxInverted "message_events_enabled" "message_events_enabled" `<h3 class="card">Message Events</h3>` .Logger.MessageEventsEnabled}}
                        </header>
                        <div class="card-body">
                            <div class="form-group">
                                <label><b>Message Events Log Channel</b></label>
                                <select class="form-control" name="message_logger_channel" data-requireperms-send>
                                    {{textChannelOptions .ActiveGuild.Channels .Logger.MessageLoggerChannel true "None"}}
                                </select>
                            </div>

                            {{checkbox "deleted_messages_enabled" "deleted_messages_enabled" "Log deleted messages" .Logger.DeletedMessagesEnabled}}
                            {{checkbox "edited_messages_enabled" "edited_messages_enabled" "Log edited messages" .Logger.EditedMessagesEnabled}}
                            {{checkbox "purged_messages_enabled" "purged_messages_enabled" "Log purged messages" .Logger.PurgedMessagesEnabled}}

                            <div class="form-group">
                                <label>Log Message (Leave empty for default) [<span class="announce-length-counter">x</span>/2000]</label><br>
                                <textarea rows="5" class="form-control" name="message_logger_msg" placeholder="Announce message here"  oninput="onCCChanged(this)">{{.Logger.MessageLoggerMSG}}</textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3">
                    <div class="card card-featured card-featured-danger">
                        <header class="card-header">
                            {{checkboxInverted "member_events_enabled" "member_events_enabled" `<h3 class="card">Member Events</h3>` .Logger.MemberEventsEnabled}}
                        </header>
                        <div class="card-body">
                            <div class="form-group">
                                <label><b>Member Events Log Channel</b></label>
                                <select class="form-control" name="member_logger_channel" data-requireperms-send>
                                    {{textChannelOptions .ActiveGuild.Channels .Logger.MemberLoggerChannel true "None"}}
                                </select>
                            </div>

                            {{checkbox "member_role_update_enabled" "member_role_update_enabled" "Log role updates" .Logger.MemberRoleUpdateEnabled}}
                            {{checkbox "member_name_update_enabled" "member_name_update_enabled" "Log name updates" .Logger.MemberNameUpdateEnabled}}
                            {{checkbox "member_avatar_update_enabled" "member_avatar_update_enabled" "Log avatar updates" .Logger.MemberAvatarUpdateEnabled}}

                            <div class="form-group">
                                <label>Log Message (Leave empty for default) [<span class="announce-length-counter">x</span>/2000]</label><br>
                                <textarea rows="5" class="form-control" name="member_logger_msg" placeholder="Announce message here"  oninput="onCCChanged(this)">{{.Logger.MemberLoggerMSG}}</textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3">
                    <div class="card card-featured card-featured-danger">
                        <header class="card-header">
                            {{checkboxInverted "voice_events_enabled" "voice_events_enabled" `<h3 class="card">Voice Events</h3>` .Logger.VoiceEventsEnabled}}
                        </header>
                        <div class="card-body">
                            <div class="form-group">
                                <label><b>Voice Events Log Channel</b></label>
                                <select class="form-control" name="voice_logger_channel" data-requireperms-send>
                                    {{textChannelOptions .ActiveGuild.Channels .Logger.VoiceLoggerChannel true "None"}}
                                </select>
                            </div>

                            {{checkbox "join_voice_enabled" "join_voice_enabled" "Join voice channel" .Logger.JoinVoiceEnabled}}
                            {{checkbox "swap_voice_enabled" "swap_voice_enabled" "Change voice channel" .Logger.SwapVoiceEnabled}}
                            {{checkbox "leave_voice_enabled" "leave_voice_enabled" "Leave voice channel" .Logger.LeaveVoiceEnabled}}

                            <div class="form-group">
                                <label>Log Message (Leave empty for default) [<span class="announce-length-counter">x</span>/2000]</label><br>
                                <textarea rows="5" class="form-control" name="voice_logger_msg" placeholder="Announce message here"  oninput="onCCChanged(this)">{{.Logger.VoiceLoggerMSG}}</textarea>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12">
            <button type="submit" class="btn btn-primary btn-lg btn-block">Save</button>
        </div>
    </div>

<script type="text/javascript">
    function onCCChanged(textArea) {
        var textAreas = textArea.parentElement.querySelectorAll('textarea');
        var combinedLength = 0;

        textAreas.forEach(function (elem) {
            combinedLength += elem.value.length;
        });

        var display = textArea.parentElement.querySelector(".announce-length-counter");
        display.textContent = combinedLength;

        if (combinedLength > 2000) {
            display.classList.add("text-danger");
        } else {
            display.classList.remove("text-danger");
        }
    }
</script>

{{template "cp_footer" .}}

{{end}}